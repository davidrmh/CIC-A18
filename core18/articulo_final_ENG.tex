\documentclass[10pt,letterpaper,onecolumn]{llncs}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{cite}
\usepackage{caption}
\usepackage{float}

\pagestyle{empty}
\begin{document}


\title{Generating trading strategies in the mexican stock market}

\author{David Ricardo Montalván Hernández \and Ricardo Barrón Fernández \and Salvador Godoy Calderón}

\institute{ Instituto Politécnico Nacional, Centro de Investigación en Computación, Ciudad de México, México.\\
\email{\{davidricardo888, barron2131, sgodoyc\}@gmail.com}}

\maketitle


\begin{abstract}
	With the digitalization of financial markets, namely, stock markets; the development of algorithms and computational techniques in order to determine trading strategies has gained relevance as much as in academia as in the industry. In this article the use of pattern recognition techniques is explored in order to determine trading strategies in the Mexican stock market.
	
	\keywords {Trading strategies, Mexican market, pattern recognition, support vector machines, multilayer perceptron, c4.5.}
	
\end{abstract}


\section{Introduction}	

The increase in computing power, the digitalization of financial markets and the opportunity of making big profits, have motivated in a large degree the research and development of computational algorithms whose purpose is the guidance in the investment decision process.

Even when the basic idea is: "buy low and sell high", given the uncertainty of financial markets, this research has used mathematical and computational techniques in order to create models that help in the trading decisions (when is the right time to buy or sell). Namely, the use of techniques in the field of artificial intelligence have gained notoriety.

The objective in this paper, is the proposal of a method or algorithm in order to generate trading signals for the Mexican stock market.

Namely, we try to find  a set of trading signals that will generate profits (losses) bigger (minor) than the ones generated by the \textbf{efficient market hypothesis}, which is discussed in section 3 and consists basically in the following strategy:

\begin{itemize}
	\item[-] Fix a time period $[0,T]$.
	\item[-] Buy at time $0$ at price $P_{0}$.
	\item[-] Sell at time $T$ at price $P_{T}$.
	\item[-] The percetange profit (loss) is given by $\dfrac{P_{T}-P_{0}}{P_{0}}$.
\end{itemize}

This work also compares the performance of various pattern recognition methodologies when applied to trading strategy generation.

Lastly, two contributions are considered. The first one is the analysis of Mexican stock market from a pattern recognition perspective, the second one is the proposal of a method for labeling financial time series.


\section{State of the arte}

In order to find trading strategies that beat consistently the \textit{Buy and Hold} strategy, multiple artificial intelligence techniques have been explored, for example one of the first works using such techniques is \cite{Allen1999}, in which genetic programming is used in order to create strategies able to beat \textit{Buy and Hold}; in this work U.S. stock market is analyzed using \textit{S\&P 500} stock index as a benchmark, they consider transaction costs but don't get favorable results.\\


In \cite{Leigh2002}, chart heuristics are used for detecting a chart pattern called \textit{bull flag}; they beat \textit{Buy and Hold} strategy but they do not consider transaction costs.\\

In \cite{Potvin2004}, the work from \cite{Allen1999} is taken up, omitting transaction costs and considering another way of creating the trees. They obtain positive results in stable and bearish (trending down) markets, but not in bullish (trending up) markets. \\


\cite{Scott2010} also use genetic programming in order to determine the strategies, being the main difference the use of monthly prices (not daily as is the usual practice); they consider transaction costs and beat \textit{Buy and Hold} strategy.\\

\cite{Leitao2016} use \textit{Perceptually Important Points} (PIP) and \textit{Symbolic Aggregate Approximation} (SAX) in order to reduce the dimensionality of the data and express it using symbols, once they have these symbols they use a genetic algorithm in order to obtaing the trading strategy. They obtain positive results but don't consider transaction costs.\\


Finally, in \cite{Kampouridis2017} an event-based time scale is considered and \textit{directional changes} are defined. Using this concept they are able to generate buy and sell signals that beat \textit{Buy and Hold} strategy even when considering transaction costs and risk adjusted performance.


\section{Fundamentos}

\subsection{Análisis técnico}
De acuerdo a \cite{tabook}, en su forma básica, el análisis técnico es el estudio de los precios y volúmenes históricos de las series accionarias financieras con la intención de guiar las  decisiones de inversión. Los supuestos básicos de este tipo de análisis son los siguientes:

\begin{itemize}
	\item Los precios están determinados únicamente por la interacción de la oferta y la demanda.
	
	\item Los precios tienden a moverse siguiendo una tendencia.
	
	\item Cambios en la oferta y la demanda provocan reversiones en las tendencias.
	
	\item Cambios en la oferta y la demanda pueden detectarse utilizando gráficas.
	
	\item Los patrones en las gráficas tienden a repetirse.
\end{itemize}

El análisis técnico hace el supuesto de que la información de todos los factores (incluyendo factores psicológicos como la avaricia, miedo, información incorrecta, etc...) que afectan las curvas de oferta y demanda, está reflejada en el precio de la acción de la compañía.

\subsection{Hipótesis del mercado eficiente (HME)}
Esta hipótesis, propuesta por Eugene Fama en los años 60's, nos dice que los cambios observados en los precios son provocados únicamente por la nueva información disponible, es decir, la información histórica (de cualquier tipo) no tiene importancia al momento de  determinar los precios del futuro, en particular, el análisis técnico no nos permite estimar las tendencias del futuro.

Existen tres versiones de la HME:
\subsubsection{Versión débil de la HME}
En su versión débil, la hipótesis del mercado eficiente nos dice que los precios del pasado no afectan los movimientos del futuro, en consecuencia, el análisis técnico es fútil para generar estrategias de inversión.
Es importante señalar que esta versión sólo hace referencia a los precios históricos, dejando abierta la posibilidad de utilizar información de otro tipo, por ejemplo estados financieros de las compañías o noticias relacionadas a ella, para predecir los precios futuros.

\subsubsection{Versión semi-fuerte de la HME}
En su versión semi-fuerte, la hipótesis del mercado eficiente nos dice que la información pública histórica (precios, estados financieros, noticias, etc...) no es de utilidad alguna al momento de predecir los movimientos del futuro. En consecuencia, sólo la información privilegiada (aquella que sólo unas cuantas personas poseen) podría ser de utilidad para predecir los movimientos del futuro.

\subsubsection{Versión fuerte de la HME}
En su versión fuerte, la hipótesis del mercado eficiente nos dice que tanto la información pública como la privilegiada no nos permiten obtener pronosticar los movimientos del mercado.

\subsection{Estrategia Buy and Hold (BH)}
Esta estrategia de inversión es la estrategia sugerida por la hipótesis del mercado eficiente y consiste en lo siguiente:

\begin{itemize}
	\item Fijar un periodo de tiempo $[0,T]$.
	\item Comprar en el inicio del periodo a un precio $P_{0}$.
	\item Vender en el final del periodo a un precio $P_{T}$.
	\item La ganancia (pérdida) porcentual es $\dfrac{P_{T}-P_{0}}{P_{0}}$
\end{itemize}

de acuerdo a la HME, la ganancia (pérdida) obtenida por la estrategia BH es la máxima (mínima) ganancia (pérdida) que se puede obtener de manera sistemática. Por lo tanto, esta estrategia será utilizada como marco de referencia al momento de compara las estrategias de inversión derivadas por los algoritmos propuestos.

\subsection{Títulos referenciados a acciones}
De acuerdo al sitio de la Bolsa Mexicana de Valores\footnote{https://www.bmv.com.mx/es/mercados/instrumentos}, el mercado mexicano cuenta con Títulos Referenciados a Acciones (TRACS), los cuales son certificados de participación que representan el patrimonio de fideicomisos de inversión y que mantienen en posición canastas de acciones de empresas cotizadas en bolsa además de una componente en efectivos. El objetivo principal de los TRACs, es replicar el comportamiento de las acciones al que está referido.

Es de principal importancia el TRAC llamado NAFTRAC el cual está referenciado al \textbf{Índice de Precios y Cotizaciones} (IPC), índice que busca reflejar el mercado accionario mexicano en su totalidad.

Buscamos entonces, estrategias que generen mejores rendimientos que aquellos generados por el NAFTRAC siguiendo la estrategia Buy and Hold.


\section{Experimentos y resultados}
\subsection{Conjunto de datos}
Para los experimentos se utilizaron precios diarios (apertura,mínimo,máximo,cierre) del NAFTRAC obtenidos de Yahoo Finance \footnote{https://finance.yahoo.com/}, esta información abarca el periodo que inicia el día 4 de febrero de 2014 (2014-02-04) y termina el 5 de abril de 2018.

Es importante señalar que este conjunto de datos no está etiquetado, por lo tanto, si buscamos detectar señales de compra o venta, es necesario primero etiquetar los datos históricos con el fin de aprender de ellos; en otras palabras, buscamos primero encontrar la estrategia que nos habría generado mayores ganancias en caso de haberla seguida (o encontrado) y a partir de ella aprender y generalizar para el futuro.

\subsubsection{Conjuntos de entrenamiento y prueba}
Para obtener los conjuntos de entrenamiento y prueba, se separó el conjunto de datos en periodos de tres meses iniciando el día 4 de febrero de 2014 siendo el periodo de prueba el periodo de los tres meses siguientes después del último día en el periodo de entrenamiento como lo ejemplifíca la siguiente tabla.

\begin{table}[H]
\caption{Ejemplo de separación de conjuntos de prueba y entrenamiento}
\label{tabla-entrena-prueba}
\centering
\begin{tabular}{cccc}
\hline Inicio entrenamiento & Fin entrenamiento & Inicio prueba & Fin prueba \\ 
\hline 2014-02-04 & 2014-04-30 & 2014-05-02 & 2014-07-31 \\ 
 2014-05-02 & 2014-07-31 & 2014-08-04 & 2014-10-31 \\ 
 2014-08-04 & 2014-10-31 & 2014-11-03 & 2015-01-30 \\ 
 2014-11-03 & 2015-01-30 & 2015-02-03 & 2015-04-30 \\ 
\hline 
\end{tabular}

\end{table} 
Utilizando este procedimiento fue posible obtener 16 conjuntos de entrenamiento y prueba.

\subsection{Proceso de etiquetamiento}
Para etiquetar el conjunto de entrenamiento se utilizó un algoritmo de estimación de distribución (EDA por sus siglas en inglés \cite{dan-simon}) el cual es un algoritmo del tipo evolutivo, en particular se utilizó un algoritmo de distribución marginal univariada (UMDA por sus siglas en inglés).

Con este algoritmo se trata de encontrar la mejor estrategia para el periodo de entrenamiento, es decir, aquella estrategia que nos habría generado las mayores ganancias.

Cada individuo en la población se codificó como un vector, $\mathbf{x}$, el cual representa una estrategia de inversión y tiene un número de componentes igual al número de días en el periodo de entrenamiento. Cada componente del vector toma un valor dentro conjunto $\{-1,0,1\}$ con $-1,0,1;$ representando señales de venta, no hacer nada y compra, respectivamente. De esta manera la \textit{i-ésima} componente representa la decisión tomada en el día $i$. El algoritmo busca individuos con la combinación de estos números que genere mayor ganancia, la cual es medida como la ganancia generada por la estrategia del individuo (los componentes del vector $\mathbf{x}$) menos la ganancia generada por la estrategia de \textit{Buy and Hold}, esta cantidad es llamada el \textbf{exceso de ganancia} y deseamos maximizarla.

\begin{figure}[H]
	\centering
	\rotatebox{0}{\includegraphics[width=1.0\linewidth]{etiquetamiento}}
	\caption{Resultado del proceso de etiquetamiento}
	\label{fig:etiquetamiento}
\end{figure}

\subsection{Atributos}
Para cada día se consideraron los precios de: apertura, mínimo, máximo y cierre; como atributos.


\subsection{Resultados}
Para cada conjunto de entrenamiento y prueba se evaluaron los siguientes modelos:

\begin{itemize}
	\item Máquina de soporte vectorial (kernel gaussiano, dando mayor importancia a las señales de compra y venta)
	
	\item Perceptrón multicapa (1 capa oculta con 10 neuronas, ReLu como activación)
	
	\item C4.5 (máxima profundidad 5)
	
\end{itemize}

La métrica de desempeño será el \textbf{exceso de ganancia}, la cual se calcula bajo los siguientes supuestos.

\subsubsection{Supuestos}
\begin{itemize}
	\item No hay ventas en corto, es decir, sólo se puede vender si ocurrió antes una compra.
	\item No se permite la ejecución de señales iguales, es decir, una vez que se ejecutó una señal de compra o venta, se tiene que esperar hasta la siguiente señal de venta o compra respectivamente.
	\item Si una señal de compra o venta se recibe en el día $t$, entonces el precio de compra o venta (precio de ejecución) se calcula como el punto medio entre el precio más alto y el más bajo del día $t+1$.
	\item Cada movimiento de compra o venta tiene un costo de transacción equivalente al $0.25 \%$ sobre el costo total, por ejemplo, si se compra una acción con un precio de $\$10$, se terminaría pagando una cantidad de $\$10(1+0.0025)$; por otro lado si se vende a un precio de $10$, se ganaría una cantidad de $\$10(1-0.0025)$.
\end{itemize}


\subsubsection{Máquina de soporte vectorial}

Utilizando una máquina de soporte vectorial, se obtuvieron los siguientes resultados para cada periodo de prueba:

\begin{table}[H]
\caption{Resultados utilizando una máquina de soporte vectorial}
\label{tabla-maquina-soporte}
\centering
\begin{tabular}{cr}
	\hline Periodo de prueba & Exceso de ganancia \\ 
	\hline 2014-05-02 a 2014-07-31 & -0.013 \\ 
	 2014-08-04 a 2014-10-31 & 0.0 \\ 
	 2014-11-03 a 2015-01-30 & 0.0 \\ 
	 2015-02-03 a 2015-04-30 & -0.058 \\ 
	 2015-05-04 a 2015-07-31 & 0.0 \\ 
	 2015-08-03 a 2015-10-30 & 0.02 \\ 
	 2015-11-04 a 2016-01-29 & 0.113 \\ 
	 2016-02-02 a 2016-04-28 & -0.053 \\ 
	 2016-05-02 a 2016-07-29 & 0.046 \\ 
	 2016-08-01 a 2016-10-31 & 0.003 \\ 
	 2016-11-01 a 2017-01-31 & 0.028 \\ 
	 2017-02-01 a 2017-04-28 & -0.008 \\ 
	 2017-05-02 a 2017-07-31 & -0.029 \\ 
	 2017-08-01 a 2017-10-31 & 0.016 \\ 
	 2017-11-03 a 2018-01-31 & -0.033 \\ 
	 2018-02-01 a 2018-04-05 & 0.0 \\ 
	\hline 
\end{tabular}
\end{table}	

El exceso de ganancia promedio fue de $0.001955$, mientras que,  condicionado a un exceso positivo (estrategias mejores a \textit{Buy and Hold}), el promedio fue de $0.038094$ y condicionado a un exceso negativo (estrategias peores que \textit{Buy and Hold}) el promedio fue de $-0.032879$.

En $6$ de $16$ pruebas se obtuvo un exceso de ganancia positivo, $4$ de $16$ un exceso igual a cero y en $6$ de $16$ un exceso de ganancia negativo.


\subsubsection{Perceptrón multicapa}
Utilizando un perceptrón multicapa se obtuvo:

\begin{table}[H]
\caption{Resultados utilizando un perceptrón multicapa}
\label{tabla-perceptron-multicapa}
\centering
\begin{tabular}{cr}
	\hline Periodo de prueba & Exceso de ganancia \\ 
	\hline 2014-05-02 a 2014-07-31 & -0.067 \\ 
	 2014-08-04 a 2014-10-31 & -0.006 \\ 
	 2014-11-03 a 2015-01-30 & 0.0 \\ 
	 2015-02-03 a 2015-04-30 & -0.066 \\ 
	 2015-05-04 a 2015-07-31 & 0.0 \\ 
	 2015-08-03 a 2015-10-30 & 0.0 \\ 
	 2015-11-04 a 2016-01-29 & 0.054 \\ 
	 2016-02-02 a 2016-04-28 & -0.053 \\ 
	 2016-05-02 a 2016-07-29 & -0.025 \\ 
	 2016-08-01 a 2016-10-31 & -0.027 \\ 
	 2016-11-01 a 2017-01-31 & 0.004 \\ 
	 2017-02-01 a 2017-04-28 & -0.045 \\ 
	 2017-05-02 a 2017-07-31 & -0.029 \\ 
	 2017-08-01 a 2017-10-31 & 0.054 \\ 
	 2017-11-03 a 2018-01-31 & 0.032 \\ 
	 2018-02-01 a 2018-04-05 & 0.0 \\ 
	\hline 
\end{tabular} 

\end{table}
	

El exceso de ganancia promedio fue de $-0.010981$, mientras que,  condicionado a un exceso positivo (estrategias mejores a \textit{Buy and Hold}), el promedio fue de $0.036499$ y condicionado a un exceso negativo (estrategias peores que \textit{Buy and Hold}) el promedio fue de $-0.040211$.

En $4$ de $16$ pruebas se obtuvo un exceso de ganancia positivo, $4$ de $16$ un exceso igual a cero y en $8$ de $16$ un exceso de ganancia negativo.

\newpage

\subsubsection{C4.5}
Utilizando un árbol C4.5 se obtienen los siguientes resultados:

\begin{table}[H]
\caption{Resultados utilizando un árbol C4.5}
\label{tabla-c4.5}
\centering
\begin{tabular}{cr}
	\hline Periodo de prueba & Exceso de ganancia \\ 
	\hline 2014-05-02 a 2014-07-31 & -0.067 \\ 
	 2014-08-04 a 2014-10-31 & -0.006 \\ 
	 2014-11-03 a 2015-01-30 & 0.0 \\ 
	 2015-02-03 a 2015-04-30 & -0.07 \\ 
	 2015-05-04 a 2015-07-31 & -0.039 \\ 
	 2015-08-03 a 2015-10-30 & 0.025 \\ 
	 2015-11-04 a 2016-01-29 & 0.091 \\ 
	 2016-02-02 a 2016-04-28 & -0.065 \\ 
	 2016-05-02 a 2016-07-29 & -0.024 \\ 
	 2016-08-01 a 2016-10-31 & -0.027 \\ 
	 2016-11-01 a 2017-01-31 & 0.01 \\ 
	 2017-02-01 a 2017-04-28 & -0.047 \\ 
	 2017-05-02 a 2017-07-31 & -0.014 \\ 
	 2017-08-01 a 2017-10-31 & 0.045 \\ 
	 2017-11-03 a 2018-01-31 & -0.06 \\ 
	 2018-02-01 a 2018-04-05 & 0.069 \\ 
	\hline 
\end{tabular} 

\end{table}

El exceso de ganancia promedio fue de $-0.010892$, mientras que,  condicionado a un exceso positivo (estrategias mejores a \textit{Buy and Hold}), el promedio fue de $0.049814$ y condicionado a un exceso negativo (estrategias peores que \textit{Buy and Hold}) el promedio fue de $-0.042335$.

En $5$ de $16$ pruebas se obtuvo un exceso de ganancia positivo, $1$ de $16$ un exceso igual a cero y en $10$ de $16$ un exceso de ganancia negativo.\\

\section{Conclusiones y trabajo futuro}

Como se puede observar, de los tres modelos utilizados, el mejor fue aquel que utiliza máquinas de soporte vectorial.

Cabe resaltar también el proceso de etiquetamiento, ya que gracias a este, nos es posible utilizar distintas herramientas de aprendizaje supervisado.

Las direcciones futuras de este trabajo podrían ser las siguientes:

\begin{itemize}
	\item Analizar la inclusión de indicadores técnicos.
	\item Probar con nuevas formas de calcular los atributos de las observaciones.
	\item Probar con otros métodos de clasificación de patrones.
	\item Probar distintas frecuencias de muestreo.
\end{itemize}

\bibliographystyle{splncs04}
\bibliography{referencias_articulo}{}



\end{document}