\documentclass[10pt,letterpaper,onecolumn]{llncs}
\usepackage[latin1]{inputenc}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{cite}
\usepackage{caption}
\usepackage{float}

\pagestyle{empty}
\begin{document}


\title{Generating trading strategies in the mexican stock market: \\
A pattern recognition approach.}

\author{David Ricardo Montalván Hernández \and Ricardo Barrón Fernández \and Salvador Godoy Calderón}

\institute{ Instituto Politécnico Nacional, Centro de Investigación en Computación, Ciudad de México, México.\\
\email{\{davidricardo888, barron2131, sgodoyc\}@gmail.com}}

\maketitle


\begin{abstract}
	With the digitalization of financial markets, namely, stock markets; the development of algorithms and computational techniques in order to determine trading strategies has gained relevance as much as in academia as in the industry. In this article the use of pattern recognition techniques is explored in order to determine trading strategies in the Mexican stock market.
	
	\keywords {Trading strategies, Mexican market, pattern recognition, support vector machines, multilayer perceptron, c4.5.}
	
\end{abstract}


\section{Introduction}	

The increase in computing power, the digitalization of financial markets and the opportunity of making big profits, have motivated in a large degree the research and development of computational algorithms whose purpose is the guidance in the investment decision process.

Even when the basic idea is: "buy low and sell high", given the uncertainty of financial markets, this research has used mathematical and computational techniques in order to create models that help in the trading decisions (when is the right time to buy or sell). Namely, the use of techniques in the field of artificial intelligence have gained notoriety.

The objective in this paper, is the proposal of a method or algorithm in order to generate trading signals for the Mexican stock market.

Namely, we try to find  a set of trading signals that will generate profits (losses) bigger (minor) than the ones generated by the \textbf{efficient market hypothesis}, which is discussed in section 3 and consists basically in the following strategy:

\begin{itemize}
	\item[-] Fix a time period $[0,T]$.
	\item[-] Buy at time $0$ at price $P_{0}$.
	\item[-] Sell at time $T$ at price $P_{T}$.
	\item[-] The percetange profit (loss) is given by $\dfrac{P_{T}-P_{0}}{P_{0}}$.
\end{itemize}

This work also compares the performance of various pattern recognition methodologies when applied to trading strategy generation.

Lastly, two contributions are considered. The first one is the analysis of Mexican stock market from a pattern recognition perspective, the second one is the proposal of a method for labeling financial time series.


\section{State of the arte}

In order to find trading strategies that beat consistently the \textit{Buy and Hold} strategy, multiple artificial intelligence techniques have been explored, for example one of the first works using such techniques is \cite{Allen1999}, in which genetic programming is used in order to create strategies able to beat \textit{Buy and Hold}; in this work U.S. stock market is analyzed using \textit{S\&P 500} stock index as a benchmark, they consider transaction costs but don't get favorable results.\\


In \cite{Leigh2002}, chart heuristics are used for detecting a chart pattern called \textit{bull flag}; they beat \textit{Buy and Hold} strategy but they do not consider transaction costs.\\

In \cite{Potvin2004}, the work from \cite{Allen1999} is taken up, omitting transaction costs and considering another way of creating the trees. They obtain positive results in stable and bearish (trending down) markets, but not in bullish (trending up) markets. \\


\cite{Scott2010} also use genetic programming in order to determine the strategies, being the main difference the use of monthly prices (not daily as is the usual practice); they consider transaction costs and beat \textit{Buy and Hold} strategy.\\

\cite{Leitao2016} use \textit{Perceptually Important Points} (PIP) and \textit{Symbolic Aggregate Approximation} (SAX) in order to reduce the dimensionality of the data and express it using symbols, once they have these symbols they use a genetic algorithm for obtaining the trading strategy. They obtain positive results but don't consider transaction costs.\\


Finally, in \cite{Kampouridis2017} an event-based time scale is considered and \textit{directional changes} are defined. Using this concept they are able to generate buy and sell signals that beat \textit{Buy and Hold} strategy even when considering transaction costs and risk adjusted performance.


\section{Basic Concepts}

\subsection{Technical Analysis}

According to \cite{tabook}, in its basic form, technical analysis is the study of historical prices and volume from a stock series with the objective of helping in the decision making process related to an investment strategy. The basic assumptions of this kind of analysis are:

\begin{itemize}
	\item Prices are uniquely determined by the interaction between supply and demand.
	
	\item Prices move following trends.
	
	\item Changes in supply and demand cause trend reversions.
	
	\item Changes in supply and demand can be detected using charts.
	
	\item Patterns in charts tend to repeat.
\end{itemize}

Technical analysis makes the assumption that the information of all factors (including psychological factors such as greed, fear, miss information, etc...) affecting supply and demand curves, is already reflected in the stock's price.


\subsection{Efficient Market Hypothesis (EMH)}

This hypothesis, proposed by Nobel prize winner Eugene Fama in the 60's, states that all the observed changes in the prices are caused only by the new available information, that is, historical data (of any kind) has no relevance when determining future trends. In particular, this hypothesis tell us that the use of technical analysis is unprofitable. 


There are three versions of EMH:
\subsubsection{Weak version of EMH}

In its weak version, the Efficient Market Hypothesis, states that historical prices don't affect future movements, thus, technical analysis is futile for the generation of trading strategies.
This version only refers to historical prices and volume, it leaves the door open for other type of data such as financial statements reports or news.


\subsubsection{Semi-strong version of EMH}
In its semi-strong version, the Efficient Market Hypothesis, states that publicly available historical information (prices, financial statements reports, news, etc..) is useless when predicting future price movements. Thus, only private/classified information might be useful for predicting future trends.

\subsubsection{Strong version of EMH}
Finally, in its strong version, the hypothesis states that even private/classified information can't be used to outperform the market.


\subsection{Buy and Hold strategy (BH)}
This is the strategy proposed by the Efficient Market Hypothesis, and consists of the following actions:

\begin{itemize}
	\item[-] Fix a time period $[0,T]$.
	\item[-] Buy at time $0$ at price $P_{0}$.
	\item[-] Sell at time $T$ at price $P_{T}$.
	\item[-] The percetange profit (loss) is given by $\dfrac{P_{T}-P_{0}}{P_{0}}$.
\end{itemize}

According to the EMH, the profit (loss) obtained by the BH strategy is the maximum (minimum) profit (loss) that one can obtain in a systematic way. Hence, this strategy will be used as a benchmark when comparing with our proposed algorithms.


\subsection{Titles Referenced to Shares}
According to Mexican Stock Exchange's website \footnote{https://www.bmv.com.mx/en/markets/instruments}, the Mexican market has Titles Referenced to Shares (TRAC's), which are participation certificates representing equity investment trusts. Their primary objective is to replicate the behavior of the stocks or portfolio which they're referred to (underlying), that is, TRAC's are Exchange Traded Funds (ETFs).

The most important TRAC is the one that represents the Mexican Stock Market as a whole and is called NAFTRAC.

Thus, our objective is finding trading strategies able to beat BH strategy using NAFTRAC data.


\section{Experiments and Results}
\subsection{Datasets}

We used daily price data (open price, maximum price, minimum price, adjusted close price) from Yahoo Finance \footnote{https://finance.yahoo.com/} for NAFTRAC and a time period between February 4th 2014 up to April 5th 2018.

Worth mention that this is an unlabeled dataset, hence, we first need to find a way to label it in order to use supervised pattern recognition techniques. The approach taken is based on the idea of "given the historical prices, what should one have had to do in order to make profits?"


\subsubsection{Training set and test set}

For obtaining the training and test sets, the data was divided in three-months periods, starting the day February 4th 2014. Following a three-months training period, there is a three-months test period, which later will become the new three-months training period, that is, we use a sliding window to separate the dataset as shown in the table below.


\begin{table}[H]
\caption{Training and test set separation}
\label{tabla-entrena-prueba}
\centering
\begin{tabular}{cccc}
\hline Start training & End training & Start test & End test \\ 
\hline 2014-02-04 & 2014-04-30 & 2014-05-02 & 2014-07-31 \\ 
 2014-05-02 & 2014-07-31 & 2014-08-04 & 2014-10-31 \\ 
 2014-08-04 & 2014-10-31 & 2014-11-03 & 2015-01-30 \\ 
 2014-11-03 & 2015-01-30 & 2015-02-03 & 2015-04-30 \\ 
\hline 
\end{tabular}

\end{table} 

Using the procedure above, we were able to obtain 16 training/test datasets.


\subsection{Labeling process}

As mentioned before, we need to label each observation in the training datasets according to one of the three possible actions, buy, sell or hold. To achive this we used an Estimation Distribution Algorithm (EDA, \cite{dan-simon}), namely, we used a version of an Univariate Marginal Distribution Algorithm (UMDA).   

This algorithm tries to find the best strategy for the given training period, that is, the strategy that would have generated a bigger (minor) profit (loss) compared to the BH strategy.

Each individual in the population was enconded as a vector, $\mathbf{x}$, representing a trading strategy and having length equal to the number of trading days in the training period. Each entry in the vector takes a value in the set $\{-1,0,1\}$, where $-1,0,1;$ represents a sell, hold and buy signal respectively. Thus the \textit{i-th} component is the decision taken on day $i$. The algorithm finds the combination maximizing the profit, which is measured as the \textbf{Excess Return} over the BH strategy, that is, the return generated by the vector $\mathbf{x}$ minus the return generated by BH.



%\begin{figure}[H]
%	\centering
%	\rotatebox{0}{\includegraphics[width=1.0\linewidth]{etiquetamiento}}
%	\caption{Resultado del proceso de etiquetamiento}
%	\label{fig:etiquetamiento}
%\end{figure}

\subsection{Features}

For each day, the open, minimum, maximum and adjusted close prices were used as features.


\subsection{Results}

For every training and test set, the following models were tested:

\begin{itemize}

	\item Support Vector Machine with gaussian kernel and assigning a class weigths of $0.45, 0.10, 0.45$ for classes $-1, 0, 1$ respectively. 
	
	\item Multilayer perceptron with a hidden layer with 10 neurons and \textit{ReLu} as activation function.
	
	
	\item C4.5 tree with max depth of 5.
	
\end{itemize}

As described above, the performance measure was \textbf{Excess Return} using the following assumptions:

\subsubsection{Supuestos}
\begin{itemize}

	\item No short-sales allowed, this means that one can only sell if a buy action ocurred in the past.
	
	\item Once a trading signal is activated, we have to wait until we see a different trading signal, so no repetitions of the same signal are allowed. This avoids excessive buys or sells.
		
	\item Since we are using end of day data, if we have a buy or sell signal on day $t$, then the buy or sell price (execution price) is the average between the minimum and maximum price at day $t+1$.
	
	\item The cost of every transaction is equal to a $0.25 \%$ over the total cost. For example, if a stock is bought  at a price of $\$10$, then the actual monetary ammount paid for is equal to $\$10(1+0.0025)$; likewise if a stock is sold at a price of $\$10$ we end up with a monetary ammount of $\$10(1-0.0025)$.
\end{itemize}

\subsubsection{Support Vector Machine}

For every test set the results using a Support Vector Machine model are the following:

\begin{table}[H]
\caption{Results obtained using a Support Vector Machine}
\label{tabla-maquina-soporte}
\centering
\begin{tabular}{cr}
	\hline Test set & Excess Return \\ 
	\hline 2014-05-02 - 2014-07-31 & -0.013 \\ 
	 2014-08-04 - 2014-10-31 & 0.0 \\ 
	 2014-11-03 - 2015-01-30 & 0.0 \\ 
	 2015-02-03 - 2015-04-30 & -0.058 \\ 
	 2015-05-04 - 2015-07-31 & 0.0 \\ 
	 2015-08-03 - 2015-10-30 & 0.02 \\ 
	 2015-11-04 - 2016-01-29 & 0.113 \\ 
	 2016-02-02 - 2016-04-28 & -0.053 \\ 
	 2016-05-02 - 2016-07-29 & 0.046 \\ 
	 2016-08-01 - 2016-10-31 & 0.003 \\ 
	 2016-11-01 - 2017-01-31 & 0.028 \\ 
	 2017-02-01 - 2017-04-28 & -0.008 \\ 
	 2017-05-02 - 2017-07-31 & -0.029 \\ 
	 2017-08-01 - 2017-10-31 & 0.016 \\ 
	 2017-11-03 - 2018-01-31 & -0.033 \\ 
	 2018-02-01 - 2018-04-05 & 0.0 \\ 
	\hline 
\end{tabular}
\end{table}	

The average excess return was $0.001955$, while conditioning on a positive and negative excess return, the average was $0.038094$ and $-0.032879$ respectively.

On $6$ out of $16$ tests we obtained a positive excess return, $4$ out of $16$ an excess return equal to zero and $6$ out of $16$ a negative excess return.

\subsubsection{Multilayer Perceptron}

For every test set the results using a Multilayer Perceptron model are the following:

\begin{table}[H]
\caption{Results obtained using a Multilayer Perceptron}
\label{tabla-perceptron-multicapa}
\centering
\begin{tabular}{cr}
	\hline Test Set & Excess Return \\ 
	\hline 2014-05-02 - 2014-07-31 & -0.067 \\ 
	 2014-08-04 - 2014-10-31 & -0.006 \\ 
	 2014-11-03 - 2015-01-30 & 0.0 \\ 
	 2015-02-03 - 2015-04-30 & -0.066 \\ 
	 2015-05-04 - 2015-07-31 & 0.0 \\ 
	 2015-08-03 - 2015-10-30 & 0.0 \\ 
	 2015-11-04 - 2016-01-29 & 0.054 \\ 
	 2016-02-02 - 2016-04-28 & -0.053 \\ 
	 2016-05-02 - 2016-07-29 & -0.025 \\ 
	 2016-08-01 - 2016-10-31 & -0.027 \\ 
	 2016-11-01 - 2017-01-31 & 0.004 \\ 
	 2017-02-01 - 2017-04-28 & -0.045 \\ 
	 2017-05-02 - 2017-07-31 & -0.029 \\ 
	 2017-08-01 - 2017-10-31 & 0.054 \\ 
	 2017-11-03 - 2018-01-31 & 0.032 \\ 
	 2018-02-01 - 2018-04-05 & 0.0 \\ 
	\hline 
\end{tabular} 

\end{table}
	
The average excess return was $-0.010981$, while conditioning on a positive and negative excess return, the average was $0.036499$ and $-0.040211$ respectively.

On $4$ out of $16$ tests we obtained a positive excess return, $4$ out of $16$ an excess return equal to zero and $8$ out of $16$ a negative excess return.

\newpage

\subsubsection{C4.5}
For every test set the results using a C4.5 tree model are the following:


\begin{table}[H]
\caption{Results obtained using a C4.5 tree}
\label{tabla-c4.5}
\centering
\begin{tabular}{cr}
	\hline Test Set & Excess Return \\ 
	\hline 2014-05-02 - 2014-07-31 & -0.067 \\ 
	 2014-08-04 - 2014-10-31 & -0.006 \\ 
	 2014-11-03 - 2015-01-30 & 0.0 \\ 
	 2015-02-03 - 2015-04-30 & -0.07 \\ 
	 2015-05-04 - 2015-07-31 & -0.039 \\ 
	 2015-08-03 - 2015-10-30 & 0.025 \\ 
	 2015-11-04 - 2016-01-29 & 0.091 \\ 
	 2016-02-02 - 2016-04-28 & -0.065 \\ 
	 2016-05-02 - 2016-07-29 & -0.024 \\ 
	 2016-08-01 - 2016-10-31 & -0.027 \\ 
	 2016-11-01 - 2017-01-31 & 0.01 \\ 
	 2017-02-01 - 2017-04-28 & -0.047 \\ 
	 2017-05-02 - 2017-07-31 & -0.014 \\ 
	 2017-08-01 - 2017-10-31 & 0.045 \\ 
	 2017-11-03 - 2018-01-31 & -0.06 \\ 
	 2018-02-01 - 2018-04-05 & 0.069 \\ 
	\hline 
\end{tabular} 

\end{table}

The average excess return was $-0.010892$, while conditioning on a positive and negative excess return, the average was $0.049814$ and $-0.042335$ respectively.

On $5$ out of $16$ tests we obtained a positive excess return, $1$ out of $16$ an excess return equal to zero and $10$ out of $16$ a negative excess return.\\


\section{Conclusion}

As we can observe, among the three models used, the best results were obtained using a Support Vector Machine.

Unfortunately, even tough when in this model we obtained a positive average excess return, using a t-test for the mean we found that we can't reject the null hypothesis that the true mean equals zero, thus we can't conclude that our method beats the BH strategy.

Also worth mention that thanks to the labeling method we can explore further more supervised learning techniques whether using a symbolic or sub-symbolic approach.

The future directions for this work might be:

\begin{itemize}
	
	\item Analyze the inclusion of technical indicators.
	\item Try with another set of features.
	\item Investigate other methods for pattern recognition.
	\item Try other sampling frequencies.
\end{itemize}

\bibliographystyle{splncs04}
\bibliography{referencias_articulo}{}



\end{document}